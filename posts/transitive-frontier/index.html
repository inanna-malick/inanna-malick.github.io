

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Transitive Frontier - </title>

  <meta name="description" content="Using `guppy` to build a tool for auditing Cargo dependency graphs"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Inanna Malick",
    
    "url": "https:\/\/recursion.wtf\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/recursion.wtf\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/recursion.wtf\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/recursion.wtf\/posts\/transitive-frontier\/",
          "name": "Transitive frontier"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Inanna Malick"
  },
  "headline": "Transitive Frontier",
  "description" : "Using \u0060guppy\u0060 to build a tool for auditing Cargo dependency graphs",
  "inLanguage" : "en",
  "wordCount":  1388 ,
  "datePublished" : "2020-12-30T00:00:00\u002b00:00",
  "dateModified" : "2020-12-30T00:00:00\u002b00:00",
  "image" : "https:\/\/recursion.wtf\/img\/avatar-icon.png",
  "keywords" : [ "guppy, rust" ],
  "mainEntityOfPage" : "https:\/\/recursion.wtf\/posts\/transitive-frontier\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/recursion.wtf\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/recursion.wtf\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Transitive Frontier" />
<meta property="og:description" content="Using `guppy` to build a tool for auditing Cargo dependency graphs">
<meta property="og:image" content="https://recursion.wtf/img/avatar-icon.png" />
<meta property="og:url" content="https://recursion.wtf/posts/transitive-frontier/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Inanna Malick" />

  <meta name="twitter:title" content="Transitive Frontier" />
  <meta name="twitter:description" content="Using `guppy` to build a tool for auditing Cargo dependency graphs">
  <meta name="twitter:image" content="https://recursion.wtf/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://recursion.wtf/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.147.8">
  <link rel="alternate" href="https://recursion.wtf/index.xml" type="application/rss+xml" title="Inanna Malick"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://recursion.wtf/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://recursion.wtf/css/syntax.css" /><link rel="stylesheet" href="https://recursion.wtf/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous"><link rel="stylesheet" href="https://recursion.wtf/css/style.css">
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://recursion.wtf/">Inanna Malick</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Inanna Malick" href="https://recursion.wtf/">
            <img class="avatar-img" src="https://recursion.wtf/img/avatar-icon.png" alt="Inanna Malick" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Transitive Frontier</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="querying-cargo-dependency-dags-with-guppy">Querying Cargo Dependency DAGs with Guppy</h2>

<link rel="stylesheet" href="https://recursion.wtf/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/img/transitive_frontier/project_with_compat_transitive_frontier.svg" alt="dependency graph"/>
    </div>
    <a href="/img/transitive_frontier/project_with_compat_transitive_frontier.svg" itemprop="contentUrl"></a>
  </figure>
</div>

<p><a href="https://crates.io/crates/guppy"><code>guppy</code></a> is a rust crate that provides tools for working with cargo dependency graphs using the <a href="https://crates.io/crates/petgraph"><code>petgraph</code></a> graph data structure crate. It&rsquo;s used by Facebook to audit a high-security subset of the cargo dependency graph for some of their more high-visibility projects. Treating the dependency graph resulting from a cargo build operation as a DAG lets us draw on the well-studied field of graph algorithms to answer complex questions about our build without resorting to ad-hoc traversals or re-implementation of common graph primitives.</p>
<p>For my first project using <code>guppy</code>, I decided to build a tool to produce machine-readable summaries describing why some target dependency is included in a cargo workspace&rsquo;s build graph. My motivation was to support projects that are migrating from <code>futures 0.1</code> to <code>futures 0.3</code>. Many rust projects started using <code>futures 0.1</code> for their initial async implementation, and are still in the process of switching over to <code>futures 0.3</code>. If you&rsquo;re interested in learning more about the differences between the two packages, <a href="https://www.ncameron.org/blog/migrating-a-crate-from-futures-0-1-to-0-3/">this blog post by ncameron</a> is a great resource. Being able to easily generate machine-readable reports opens up new possibilities - for example, you could use the output of this tool to build a linter that asserts that no new transitive dependencies on <code>futures 0.1</code> are introduced into a workspace, to provide tooling-backed assurances that usage of <code>futures 0.1</code> only ever decreases.</p>
<p>The technical name for this is <em>reverse transitive dependency</em>, which is just the name for the subset of the dependency graph that leads back to some target dependency.
I decided to focus on the <em>workspace frontier</em>, which I&rsquo;ve defined as the set of edges in a dependency graph that originate from within a cargo workspace but do not terminate in that cargo workspace. These are the edges in the dependency graph via which dependencies on external packages are introduced into the workspace, which makes them the natural focus for my use case. Since I&rsquo;m specifically interested in the places where some dependencies on some specific package make their way into the workspace, I can narrow my search to the subset of the dependency graph that leads back to that package, otherwise known as the <em>reverse transitive dependencies</em> of that package.</p>
<p>I&rsquo;ve called this tool <code>transitive-frontier</code>, because it finds the intersection of the workspace frontier and the reverse transitive dependency graph - that is, the places where dependencies on some target package are introduced into a cargo workspace. on some package are introduced. Building it has been a great way to familiarize myself with <code>guppy</code>. You can find it on github <a href="https://github.com/inanna-malick/transitive-frontier">here</a>, if you&rsquo;d like to follow along or use it to audit dependencies in one of your projects.</p>
<h2 id="using-guppy">Using Guppy</h2>
<p>Before describing the <code>transitive_frontier</code> tool, I&rsquo;m going to go over how I use <code>guppy</code>: these examples are run against some simple strawman workspaces, which you can find in the <code>example_workspaces</code> directory in the <code>transitive_frontier</code> repo. Here&rsquo;s a simplified representation of the dependency graph for the first workspace:</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/img/transitive_frontier/project.svg" alt="dependency graph"/>
    </div>
    <a href="/img/transitive_frontier/project.svg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>The main entry point into <code>guppy</code> is the <code>PackageGraph</code>, which holds information about the dependency graph resulting from a cargo build operation (as generated via <code>cargo metadata</code>). Here&rsquo;s how to construct a <code>PackageGraph</code> instance for your workspace:</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#286983">mut</span> <span style="color:#d7827e">cmd</span> <span style="color:#797593">=</span> <span style="color:#d7827e">MetadataCommand</span>::<span style="color:#d7827e">new</span><span style="color:#797593">();</span>
</span></span><span style="display:flex;"><span><span style="color:#286983">if</span> <span style="color:#286983">let</span> <span style="color:#d7827e">Some</span><span style="color:#797593">(</span><span style="color:#d7827e">workspace</span><span style="color:#797593">)</span> <span style="color:#797593">=</span> <span style="color:#797593">&amp;</span><span style="color:#d7827e">opt</span><span style="color:#797593">.</span><span style="color:#d7827e">workspace</span> <span style="color:#797593">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d7827e">cmd</span><span style="color:#797593">.</span><span style="color:#d7827e">current_dir</span><span style="color:#797593">(</span><span style="color:#d7827e">workspace</span><span style="color:#797593">);</span>
</span></span><span style="display:flex;"><span><span style="color:#797593">}</span>
</span></span><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#d7827e">package_graph</span> <span style="color:#797593">=</span> <span style="color:#d7827e">PackageGraph</span>::<span style="color:#d7827e">from_command</span><span style="color:#797593">(</span><span style="color:#797593">&amp;</span><span style="color:#286983">mut</span> <span style="color:#d7827e">cmd</span><span style="color:#797593">)</span><span style="color:#797593">?</span><span style="color:#797593">;</span>
</span></span></code></pre></div><p>Next, let&rsquo;s construct a query to find all the packages that depend on <code>futures 0.1</code> in this package graph. You can find package ids in the output of <code>cargo metadata</code>, but the <code>transitive_frontier</code> tool supports providing a substring of the target package id for convenience.</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#d7827e">futures</span> <span style="color:#797593">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ea9d34">&#34;futures 0.1.30 (registry+https://github.com/rust-lang/crates.io-index)&#34;</span><span style="color:#797593">;</span>
</span></span><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#d7827e">target_dependency</span> <span style="color:#797593">=</span> <span style="color:#d7827e">PackageId</span>::<span style="color:#d7827e">new</span><span style="color:#797593">(</span><span style="color:#d7827e">futures</span><span style="color:#797593">);</span>
</span></span><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#d7827e">package_query</span> <span style="color:#797593">=</span> <span style="color:#d7827e">package_graph</span><span style="color:#797593">.</span><span style="color:#d7827e">query_reverse</span><span style="color:#797593">(</span><span style="color:#d7827e">iter</span>::<span style="color:#d7827e">once</span><span style="color:#797593">(</span><span style="color:#d7827e">id</span><span style="color:#797593">))</span><span style="color:#797593">?</span><span style="color:#797593">;</span>
</span></span></code></pre></div><p>After building a query, we resolve it, yielding a <code>PackageSet</code>. It&rsquo;s possible to add filters at this stage, to avoid traversing certain dependency edges.</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#d7827e">package_set</span> <span style="color:#797593">=</span> <span style="color:#d7827e">package_query</span><span style="color:#797593">.</span><span style="color:#d7827e">resolve</span><span style="color:#797593">();</span>
</span></span></code></pre></div><p>After we&rsquo;ve constructed the query, we need to resolve it - this step is where we actually traverse edges to build a package set. Here we&rsquo;re just resolving every edge that the query matches, but <code>guppy</code> also supports resolving queries with a filter function, to allow for skipping some edges.</p>
<p>Here&rsquo;s a visualization of the package set this query produces, with the reverse transitive dependencies of <code>futures 0.1</code> highlighted:</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/img/transitive_frontier/project_with_transitive_deps.svg" alt="dependency graph"/>
    </div>
    <a href="/img/transitive_frontier/project_with_transitive_deps.svg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>However, we don&rsquo;t want a package set - we want the frontier via which dependencies <code>futures 0.1</code> are introduced into our workspace, shown further highlighted here:</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/img/transitive_frontier/project_with_transitive_frontier.svg" alt="dependency graph"/>
    </div>
    <a href="/img/transitive_frontier/project_with_transitive_frontier.svg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>For this step, we need to traverse the set of edges included in the <code>PackageSet</code>. Since it&rsquo;s a <em>package</em> set, it only tracks packages, so what we&rsquo;re actually doing is iterating over every edge in the package graph for where <code>to</code> and <code>from</code> are members of the package set.</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#286983">mut</span> <span style="color:#d7827e">frontier</span> <span style="color:#797593">=</span> <span style="color:#d7827e">HashMap</span>::<span style="color:#d7827e">new</span><span style="color:#797593">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#286983">for</span> <span style="color:#d7827e">link</span> <span style="color:#286983">in</span> <span style="color:#d7827e">package_set</span><span style="color:#797593">.</span><span style="color:#d7827e">links</span><span style="color:#797593">(</span><span style="color:#d7827e">DependencyDirection</span>::<span style="color:#d7827e">Reverse</span><span style="color:#797593">)</span> <span style="color:#797593">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#9893a5">// != implements logical xor
</span></span></span><span style="display:flex;"><span><span style="color:#9893a5"></span>    <span style="color:#286983">if</span> <span style="color:#d7827e">link</span><span style="color:#797593">.</span><span style="color:#d7827e">to</span><span style="color:#797593">().</span><span style="color:#d7827e">in_workspace</span><span style="color:#797593">()</span> <span style="color:#797593">!=</span> <span style="color:#d7827e">link</span><span style="color:#797593">.</span><span style="color:#d7827e">from</span><span style="color:#797593">().</span><span style="color:#d7827e">in_workspace</span><span style="color:#797593">()</span> <span style="color:#797593">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#286983">let</span> <span style="color:#d7827e">entry</span> <span style="color:#797593">=</span> <span style="color:#d7827e">frontier</span>
</span></span><span style="display:flex;"><span>            <span style="color:#797593">.</span><span style="color:#d7827e">entry</span><span style="color:#797593">(</span><span style="color:#d7827e">link</span><span style="color:#797593">.</span><span style="color:#d7827e">from</span><span style="color:#797593">().</span><span style="color:#d7827e">name</span><span style="color:#797593">().</span><span style="color:#d7827e">to_string</span><span style="color:#797593">())</span>
</span></span><span style="display:flex;"><span>            <span style="color:#797593">.</span><span style="color:#d7827e">or_insert_with</span><span style="color:#797593">(</span><span style="color:#d7827e">Vec</span>::<span style="color:#d7827e">new</span><span style="color:#797593">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d7827e">entry</span><span style="color:#797593">.</span><span style="color:#d7827e">push</span><span style="color:#797593">(</span><span style="color:#d7827e">format!</span><span style="color:#797593">(</span><span style="color:#ea9d34">&#34;</span><span style="color:#ea9d34">{}</span><span style="color:#ea9d34"> </span><span style="color:#ea9d34">{}</span><span style="color:#ea9d34">&#34;</span><span style="color:#797593">,</span> <span style="color:#d7827e">link</span><span style="color:#797593">.</span><span style="color:#d7827e">to</span><span style="color:#797593">().</span><span style="color:#d7827e">name</span><span style="color:#797593">(),</span> <span style="color:#d7827e">link</span><span style="color:#797593">.</span><span style="color:#d7827e">to</span><span style="color:#797593">().</span><span style="color:#d7827e">version</span><span style="color:#797593">()))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#797593">}</span>
</span></span><span style="display:flex;"><span><span style="color:#797593">}</span>
</span></span></code></pre></div><p>This code block iterates over every edge in the <code>PackageSet</code>, taking edges with one end inside the workspace and the other outside it and storing them in a <code>HashMap</code> keyed by the name of the package introducing the dependency, resulting in this output:</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#d7827e">target_dependency</span> <span style="color:#797593">=</span> <span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#797593">[</span><span style="color:#d7827e">frontier</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">capabilities-old</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;library_old 0.1.0&#34;</span><span style="color:#797593">,</span> <span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">server</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span><span style="color:#797593">]</span>
</span></span></code></pre></div><p>You can reproduce this by running the following command in the <code>transitive_frontier</code> repo: <code>cargo run -- -p &quot;futures 0.1&quot; -- example_workspaces/project</code>. This example, and those that will follow, highlight snippets of code similar to those used to implement the functionality of the <code>transitive_frontier</code> tool.</p>
<h3 id="ignoring-packages">Ignoring Packages</h3>
<p>In a real project that&rsquo;s still migrating off <code>futures 0.1</code> usage, <code>futures 0.3</code> would likely be compiled with the <code>compat</code> feature enabled, to better support interop. <code>example_packages/project_with_compat</code> provides an example of this. Let&rsquo;s take a look at the transitive frontier for <code>futures 0.1</code> for that workspace, via <code>cargo run -- -p &quot;futures 0.1&quot; -- example_workspaces/project_with_compat</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#d7827e">target_dependency</span> <span style="color:#797593">=</span> <span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#797593">[</span><span style="color:#d7827e">frontier</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">capabilities-old</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span><span style="color:#797593">,</span> <span style="color:#ea9d34">&#34;library_old 0.1.0&#34;</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">server</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;futures 0.3.8&#34;</span><span style="color:#797593">,</span> <span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">capabilities-new</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;library_new 0.1.0&#34;</span><span style="color:#797593">,</span> <span style="color:#ea9d34">&#34;futures 0.3.8&#34;</span><span style="color:#797593">]</span>
</span></span></code></pre></div><p>Unfortunately, the <code>compat</code> dependency in <code>futures_util</code> makes <code>futures 0.1</code> a transitive dependency of <code>futures 0.3</code>, which causes every edge that introduces a dependency on <code>futures 0.3</code> to be included in the report. This is not the desired behavior. Here&rsquo;s a visualization of the problem, showing the path via which <code>futures 0.3</code> depends on <code>futures 0.1</code>:</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/img/transitive_frontier/project_futures_util_compat.svg" alt="dependency graph"/>
    </div>
    <a href="/img/transitive_frontier/project_futures_util_compat.svg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>To solve this issue, we&rsquo;re going to have to skip some edges:</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#286983">let</span> <span style="color:#d7827e">package_set</span> <span style="color:#797593">=</span> <span style="color:#d7827e">package_query</span>
</span></span><span style="display:flex;"><span>      <span style="color:#797593">.</span><span style="color:#d7827e">resolve_with_fn</span><span style="color:#797593">(</span><span style="color:#797593">|</span><span style="color:#d7827e">_</span><span style="color:#797593">,</span> <span style="color:#d7827e">link</span><span style="color:#797593">|</span> <span style="color:#797593">!</span><span style="color:#d7827e">opt</span><span style="color:#797593">.</span><span style="color:#d7827e">skip</span><span style="color:#797593">.</span><span style="color:#d7827e">iter</span><span style="color:#797593">().</span><span style="color:#d7827e">any</span><span style="color:#797593">(</span><span style="color:#797593">|</span><span style="color:#d7827e">s</span><span style="color:#797593">|</span> <span style="color:#d7827e">link</span><span style="color:#797593">.</span><span style="color:#d7827e">to</span><span style="color:#797593">().</span><span style="color:#d7827e">id</span><span style="color:#797593">().</span><span style="color:#d7827e">repr</span><span style="color:#797593">().</span><span style="color:#d7827e">contains</span><span style="color:#797593">(</span><span style="color:#d7827e">s</span><span style="color:#797593">)));</span>
</span></span></code></pre></div><p>This code block takes a provided list of substrings to ignore and skips edges to any package with an id containing an ignored substring. Let&rsquo;s try regenerating the transitive frontier with that enabled, via <code>cargo run -- -p &quot;futures 0.1&quot; --skip &quot;futures-util&quot; -- example_workspaces/project_with_compat</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#d7827e">target_dependency</span> <span style="color:#797593">=</span> <span style="color:#ea9d34">&#34;futures 0.1.30 (registry+https://github.com/rust-lang/crates.io-index)&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#797593">[</span><span style="color:#d7827e">frontier</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">capabilities-old</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;library_old 0.1.0&#34;</span><span style="color:#797593">,</span> <span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span><span style="color:#797593">]</span>
</span></span><span style="display:flex;"><span><span style="color:#d7827e">server</span> <span style="color:#797593">=</span> <span style="color:#797593">[</span><span style="color:#ea9d34">&#34;futures 0.1.30&#34;</span><span style="color:#797593">]</span>
</span></span></code></pre></div><p>That fixes the problem by skipping <code>futures-util</code>, as you can see in this visualization:</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/img/transitive_frontier/project_with_compat_transitive_frontier.svg" alt="dependency graph"/>
    </div>
    <a href="/img/transitive_frontier/project_with_compat_transitive_frontier.svg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>Now we have the ability to generate machine-readable reports on where transitive dependencies on <code>futures 0.1</code> enter the workspace. For this workspace, that doesn&rsquo;t mean that much, but for larger workspaces with tens or even hundreds of crates automating processes like this can be critical.</p>
<h2 id="summary">Summary</h2>
<p>Guppy has been really great to work with. It provides a great set of tools for querying cargo dependency graphs, the docs are really comprehensive, and the maintainers are really responsive and helpful (thanks @rain!). I particularly appreciated being able to explore the problem by writing code to query the graph instead of grepping<code>Cargo.toml</code> files.  I was able to leverage all this to build the <code>transitive_frontier</code> tool really quickly. The abstractions provided by <code>guppy</code> let me spend most of my development time exploring the problem space and thinking about output formats.</p>
<p><code>transitive_frontier</code> supports outputting two machine readable formats (JSON, TOML) and one human readable one (HTML). You can fetch it via <code>cargo install transitive_frontier</code>.</p>
<h2 id="example-invocations">Example Invocations</h2>
<ul>
<li>Find the transitive frontier for <code>futures 0.1</code> for a workspace and output TOML:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>transitive_frontier -p <span style="color:#ea9d34">&#34;futures 0.1&#34;</span> --skip <span style="color:#ea9d34">&#34;futures-util&#34;</span> <span style="color:#286983">\
</span></span></span><span style="display:flex;"><span><span style="color:#286983"></span>                    -f toml -- ~/target/dir &gt; summary.toml
</span></span></code></pre></div><ul>
<li>Find the transitive frontier for <code>futures 0.1</code> for a workspace and output JSON:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>transitive_frontier -p <span style="color:#ea9d34">&#34;futures 0.1&#34;</span> --skip <span style="color:#ea9d34">&#34;futures-util&#34;</span> <span style="color:#286983">\
</span></span></span><span style="display:flex;"><span><span style="color:#286983"></span>                    -f json -- ~/target/dir &gt; summary.json
</span></span></code></pre></div><ul>
<li>Find the transitive frontier for <code>futures 0.1</code> for a workspace and output HTML:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#575279;background-color:#faf4ed;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>transitive_frontier -p <span style="color:#ea9d34">&#34;futures 0.1&#34;</span> --skip <span style="color:#ea9d34">&#34;futures-util&#34;</span> <span style="color:#286983">\
</span></span></span><span style="display:flex;"><span><span style="color:#286983"></span>                    -f html -- ~/target/dir &gt; summary.html
</span></span></code></pre></div>

        
          <div class="blog-tags">
            
              
              <a href="https://recursion.wtf/tags/guppy/">guppy</a>&nbsp;
            
              
              <a href="https://recursion.wtf/tags/rust/">rust</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2frecursion.wtf%2fposts%2ftransitive-frontier%2f&amp;text=Transitive%20Frontier&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frecursion.wtf%2fposts%2ftransitive-frontier%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2frecursion.wtf%2fposts%2ftransitive-frontier%2f&amp;title=Transitive%20Frontier" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2frecursion.wtf%2fposts%2ftransitive-frontier%2f&amp;title=Transitive%20Frontier" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2frecursion.wtf%2fposts%2ftransitive-frontier%2f&amp;title=Transitive%20Frontier" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2frecursion.wtf%2fposts%2ftransitive-frontier%2f&amp;description=Transitive%20Frontier" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/posts/recursion_lib_intro/">Recursion: a quick introduction</a></li>
                
                    <li><a href="/posts/rust_schemes_3/">Single Pass Recursion in Rust</a></li>
                
                    <li><a href="/posts/rust_schemes_2/">Fully generic recursion in Rust</a></li>
                
                    <li><a href="/posts/rust_schemes/">Elegant and performant recursion in Rust</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
          
            <li class="next">
              <a href="https://recursion.wtf/posts/infinity_mirror_hypercrystal/" data-toggle="tooltip" data-placement="top" title="Infinity Mirror HYPERCRYSTAL">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
      
      
      
      
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2025
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://recursion.wtf/">Inanna Malick</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.147.8</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://recursion.wtf/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://recursion.wtf/js/load-photoswipe.js"></script>










    
  </body>
</html>

